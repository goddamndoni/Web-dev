import { animate, style, transition, trigger } from '@angular/animations';
import { CommonModule } from '@angular/common';
import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output, ViewChild, ViewChildren, } from '@angular/core';
import { UA, isBrowser, } from '../../core';
import { MediaDirective } from '../../directives/media.directive';
import { SafePipe } from '../../pipes/safe.pipe';
import { CounterComponent } from '../counter/counter.component';
import { ChevronIconComponent } from '../icons/chevron/chevron-icon.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
const passiveEventListenerOpts = {
    passive: true,
};
export class ViewerComponent {
    set noAnimation(value) {
        this.itemListRef.nativeElement.style.transitionDuration = value
            ? '0ms'
            : '400ms';
    }
    get counterIndex() {
        return Math.floor(this.selectedIndex / this.moveByItems);
    }
    get showArrow() {
        return this.arrows && this.items && this.items.length > 1;
    }
    get showPrevArrow() {
        return this.showArrow && (this.selectedIndex > 0 || this.reallyLoop);
    }
    get showNextArrow() {
        return (this.showArrow &&
            (this.selectedIndex < this.items.length - 1 || this.reallyLoop));
    }
    constructor(_hostRef, _cd, _destroyRef, _zone) {
        this._hostRef = _hostRef;
        this._cd = _cd;
        this._destroyRef = _destroyRef;
        this._zone = _zone;
        this.itemClick = new EventEmitter();
        this.descriptionClick = new EventEmitter();
        this.selection = new EventEmitter();
        this.fringeCount = this.getFringeCount();
        this._itemWidth = 0;
        this.pointerDeltaX = 0;
        this.sliding = false;
        this.repositionOnFringe = entries => {
            if (!this.reallyLoop || !this.sliding) {
                return;
            }
            const { first } = this.itemsRef;
            const visibleEntries = entries.filter(e => e.isIntersecting);
            if (visibleEntries.length === 0) {
                return;
            }
            const beginningVisible = entries[0].target === first.nativeElement;
            this.pointerDeltaX +=
                (beginningVisible ? -1 : 1) * this.items.length * this._itemWidth;
        };
        this.updateDimensions = () => {
            this._itemWidth =
                this._hostRef.nativeElement.querySelector('li').offsetWidth;
        };
        this.shiftByDelta = (delta) => {
            this.pointerDeltaX += delta;
            this.shift(this.pointerDeltaX);
        };
    }
    ngOnChanges({ visibleItems, items, loop }) {
        if (visibleItems) {
            this.itemListRef.nativeElement.style.setProperty('--item-width', `calc(100% / ${this.visibleItems})`);
            setTimeout(this.updateDimensions);
        }
        if (loop || items) {
            this.reallyLoop = this.items.length > 1 ? this.loop : false;
            if (this.reallyLoop) {
                setTimeout(() => this.observeFringes());
            }
        }
        if (items || visibleItems || loop) {
            this.fringeCount = this.getFringeCount();
            this.displayedItems = this.getItemsToBeDisplayed(this.fringeCount);
        }
    }
    ngOnInit() {
        if (isBrowser) {
            this.handleResizes();
            if (this.mouseGestures) {
                this.handleMouseSlides();
            }
            if (this.touchGestures) {
                this.handleTouchSlides();
            }
            this._destroyRef.onDestroy(() => this.fringeObserver?.disconnect());
        }
    }
    ngAfterViewInit() {
        this.center();
        setTimeout(() => (this.noAnimation = false));
    }
    isYoutube(item) {
        return !!item.src.match(/youtube.*\/embed\//);
    }
    select(index, shortPath = true) {
        if (this.selectedIndex === index) {
            return this.center();
        }
        if (this.items[this.selectedIndex]?.video) {
            this.stopCurrentVideo();
        }
        // The purpose of the short path here is best understood by the following example: If going from index
        // 6 (last) to index 0, do not go back over all the middle items, but go 6 -> 0 the short route. This
        // makes navigating slider smoother. This of course applies in the other direction as well.
        if (this.visibleItems > 1 && shortPath) {
            const maxIndex = this.items.length - this.visibleItems;
            // When going back, in direction over the first item, stop at the slider's beginning at first.
            if (this.selectedIndex !== 0 && index < 0) {
                index = 0;
            }
            else if (this.selectedIndex < maxIndex) {
                // Set the desired index or choose the last if it is the slider's last "page".
                index = Math.min(maxIndex, index);
            }
            else if (index > maxIndex) {
                // Loop to the first item if going over the slider's end. This trick makes the loop cross the
                // boundary between the last and the first.
                index = this.items.length;
            }
        }
        const indexOutOfBounds = !this.items[index];
        const looping = this.reallyLoop && indexOutOfBounds;
        if (looping) {
            this.loopTo(index);
            return this.selection.emit(this.selectedIndex);
        }
        this.selectedIndex = indexOutOfBounds
            ? this.correctIndexOutOfBounds(index)
            : index;
        this.center(); // we center only for this branch since looping does a delayed centering
        this.selection.emit(this.selectedIndex);
    }
    selectByDelta(delta) {
        this.select(this.selectedIndex + delta);
    }
    onImageClick(item, event) {
        this.itemClick.emit({
            event,
            item,
            index: this.items.indexOf(item),
        });
    }
    onTab(nextItemIndex) {
        nextItemIndex = nextItemIndex - this.fringeCount;
        // allow focus to escape viewer
        if (nextItemIndex >= 0 && nextItemIndex < this.items.length) {
            this.select(nextItemIndex);
            // focusing an item literally scrolls the item list, so I have to scroll it back
            requestAnimationFrame(() => (this._hostRef.nativeElement.scrollLeft = 0));
        }
    }
    onItemErrored(item) {
        if (!this.showErrors) {
            return;
        }
        item._failed = true;
        this._cd.detectChanges();
    }
    itemFailedToLoad(item) {
        return item._failed;
    }
    itemTabbable(index) {
        index = index - this.fringeCount;
        return index >= 0 && index < this.items.length ? 0 : -1;
    }
    center() {
        this.shift();
    }
    correctIndexOutOfBounds(index) {
        return index < 0 ? 0 : this.items.length - 1;
    }
    getFringeCount() {
        return this.reallyLoop
            ? Math.min(Math.ceil(this.visibleItems), this.items.length)
            : 0;
    }
    getItemsToBeDisplayed(fringeCount) {
        return this.reallyLoop
            ? [
                ...this.items.slice(-fringeCount),
                ...this.items,
                ...this.items.slice(0, fringeCount),
            ]
            : this.items;
    }
    handleMouseSlides() {
        this._zone.runOutsideAngular(() => {
            const hostEl = this._hostRef.nativeElement;
            let mousedown;
            let maxDeltaX = 0;
            let maxDeltaY = 0;
            const onmousedown = (e) => {
                mousedown = e;
                this.noAnimation = this.sliding = true;
                document.addEventListener('mousemove', onmousemove, passiveEventListenerOpts);
                document.addEventListener('mouseup', onmouseup, passiveEventListenerOpts);
            };
            const onmousemove = (e) => {
                maxDeltaX = Math.max(Math.abs(mousedown.x - e.x));
                maxDeltaY = Math.max(Math.abs(mousedown.y - e.y));
                this.shiftByDelta(e.movementX);
            };
            const onmouseup = () => {
                this.noAnimation = this.sliding = false;
                this._zone.run(() => this.selectBySwipeStats(this.pointerDeltaX));
                this.pointerDeltaX = 0;
                document.removeEventListener('mousemove', onmousemove);
                document.removeEventListener('mouseup', onmouseup);
            };
            const onclick = (e) => {
                if (maxDeltaX > 10 || maxDeltaY > 10) {
                    e.stopPropagation();
                    // to prevent playing a video on swipe
                    e.preventDefault();
                }
                maxDeltaY = maxDeltaX = 0;
            };
            const ondragstart = (e) => e.preventDefault();
            hostEl.addEventListener('mousedown', onmousedown, passiveEventListenerOpts);
            hostEl.addEventListener('click', onclick, { capture: true });
            hostEl.addEventListener('dragstart', ondragstart);
            this._destroyRef.onDestroy(() => {
                hostEl.removeEventListener('mousedown', onmousedown);
                hostEl.removeEventListener('click', onclick);
                hostEl.removeEventListener('dragstart', ondragstart);
            });
        });
    }
    handleTouchSlides() {
        this._zone.runOutsideAngular(() => {
            const hostEl = this._hostRef.nativeElement;
            let horizontal;
            let touchstart;
            let lastTouchmove;
            const ontouchstart = (e) => {
                touchstart = e;
                this.noAnimation = this.sliding = true;
            };
            const ontouchmove = (e) => {
                if (!touchstart || e.touches.length !== 1) {
                    return;
                }
                const startTouch = touchstart.touches[0];
                const moveTouch = e.touches[0];
                if (horizontal == null) {
                    const deltaX = Math.abs(moveTouch.clientX - startTouch.clientX);
                    const deltaY = Math.abs(moveTouch.clientY - startTouch.clientY);
                    if (deltaX || deltaY) {
                        horizontal = deltaX * 1.2 >= deltaY;
                    }
                }
                if (horizontal) {
                    this.shiftByDelta(moveTouch.clientX - (lastTouchmove ?? touchstart).touches[0].clientX);
                    lastTouchmove = e;
                    if (UA.ios) {
                        e.preventDefault();
                        e.stopPropagation();
                    }
                }
            };
            const ontouchend = () => {
                this.noAnimation = this.sliding = false;
                this._zone.run(() => this.selectBySwipeStats(this.pointerDeltaX));
                this.pointerDeltaX = 0;
                horizontal = undefined;
                touchstart = undefined;
                lastTouchmove = undefined;
            };
            hostEl.addEventListener('touchstart', ontouchstart, passiveEventListenerOpts);
            document.addEventListener('touchmove', ontouchmove, {
                passive: !UA.ios,
            });
            document.addEventListener('touchend', ontouchend, passiveEventListenerOpts);
            this._destroyRef.onDestroy(() => {
                hostEl.removeEventListener('touchstart', ontouchstart);
                document.removeEventListener('touchmove', ontouchmove);
                document.removeEventListener('touchend', ontouchend);
            });
        });
    }
    handleResizes() {
        window.addEventListener('resize', this.updateDimensions, passiveEventListenerOpts);
        this._destroyRef.onDestroy(() => {
            window.removeEventListener('resize', this.updateDimensions);
        });
    }
    loopTo(desiredIndex) {
        this.noAnimation = true;
        const shift = Math.sign(desiredIndex) * this.items.length * this._itemWidth;
        this.shiftByDelta(shift);
        this.selectedIndex =
            desiredIndex < 0
                ? desiredIndex + this.items.length
                : desiredIndex - this.items.length;
        // NOTE: This is needed so that animation is reactivated really only after the loop shift
        // happened. Without the requestAnimationFrame, the setTimeout is often not enough, as it
        // can happen still before the next frame is painted, which would cause the loop shift
        // to be animated.
        // But, requestAnimationFrame is not enough as its callback is called BEFORE the next paint,
        // not after. Second requestAnimationFrame would also be possible, but setTimeout is better
        // as it's called right after the next paint happens.
        requestAnimationFrame(() => setTimeout(() => {
            this.pointerDeltaX = 0;
            this.noAnimation = false;
            this.center();
        }));
    }
    observeFringes() {
        if (!isBrowser) {
            return;
        }
        this.fringeObserver?.disconnect();
        const observer = new IntersectionObserver(this.repositionOnFringe, {
            root: this._hostRef.nativeElement,
            threshold: 1.0,
        });
        observer.observe(this.itemsRef.first.nativeElement);
        observer.observe(this.itemsRef.last.nativeElement);
        this.fringeObserver = observer;
    }
    selectBySwipeStats(distance) {
        // I use round instead of previous ceil here because the ceil was pretty one-sided in where the
        // index delta would move. This was apparent in looping mode, where items that were clearly to be
        // scrolled to were actually hidden in favor of items that were barely visible, but selected thanks
        // to Math.ceil.
        // Now I use magical constant 2.25 to make sure a tiny swipe slides to next items, but there is still
        // a tiny threshold to make sure the slide doesn't always happen.
        const indexDelta = Math.round((Math.abs(distance) + this._itemWidth / 2.25) / this._itemWidth) * -Math.sign(distance);
        const newIndex = this.selectedIndex + indexDelta;
        this.select(newIndex, false);
    }
    shift(delta = 0) {
        const multiplier = this.isRtl ? 1 : -1;
        const index = (this.selectedIndex + this.fringeCount) * multiplier;
        delta *= -multiplier;
        const shift = `calc(${index} * var(--item-width) + ${delta}px)`;
        this.itemListRef.nativeElement.style.transform = `translate3d(${shift}, 0, 0)`;
    }
    stopCurrentVideo() {
        const videoEl = this.itemsRef
            .get(this.selectedIndex)
            ?.nativeElement.querySelector('video');
        if (videoEl) {
            videoEl.pause();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: ViewerComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }, { token: i0.DestroyRef }, { token: i0.NgZone }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.8", type: ViewerComponent, isStandalone: true, selector: "viewer", inputs: { items: "items", selectedIndex: "selectedIndex", arrows: "arrows", descriptions: "descriptions", errorText: "errorText", showErrors: "showErrors", mouseGestures: "mouseGestures", touchGestures: "touchGestures", counter: "counter", counterOrientation: "counterOrientation", loading: "loading", objectFit: "objectFit", itemTemplate: "itemTemplate", errorTemplate: "errorTemplate", arrowTemplate: "arrowTemplate", contentTemplate: "contentTemplate", thumbsOrientation: "thumbsOrientation", aria: "aria", loop: "loop", visibleItems: "visibleItems", moveByItems: "moveByItems", clip: "clip", isRtl: "isRtl" }, outputs: { itemClick: "itemClick", descriptionClick: "descriptionClick", selection: "selection" }, host: { properties: { "class.clip": "this.clip", "class.rtl": "this.isRtl" } }, viewQueries: [{ propertyName: "itemListRef", first: true, predicate: ["itemList"], descendants: true, static: true }, { propertyName: "itemsRef", predicate: ["itemsRef"], descendants: true }], usesOnChanges: true, ngImport: i0, template: "<button\n  *ngIf=\"showPrevArrow\"\n  aria-label=\"Previous image\"\n  class=\"viewer-arrow viewer-arrow-prev\"\n  (mousedown)=\"$event.stopPropagation()\"\n  (click)=\"selectByDelta(-moveByItems)\"\n>\n  <chevron-icon *ngIf=\"!arrowTemplate; else $any(arrowTemplate)\"></chevron-icon>\n</button>\n\n<ul #itemList [attr.aria-label]=\"aria?.viewerLabel\">\n  <li *ngIf=\"!displayedItems?.length\" class=\"viewer-initial-item\"></li>\n  <li\n    #itemsRef\n    *ngFor=\"let item of displayedItems; let i = index\"\n    media\n    [attr.tabindex]=\"itemTabbable(i)\"\n    [attr.aria-label]=\"item.alt\"\n    [attr.aria-describedby]=\"'viewer-aria-description-' + i\"\n    (click)=\"onImageClick(item, $event)\"\n    (mediaLoadError)=\"onItemErrored(item)\"\n    (keydown.Tab)=\"onTab(i + 1)\"\n    (keydown.shift.Tab)=\"onTab(i - 1)\"\n  >\n    <ng-container *ngIf=\"!itemTemplate; else customTemplate\">\n      <picture *ngIf=\"!item.video\" @mediaAnimate>\n        <source\n          *ngFor=\"let source of item.pictureSources\"\n          [srcset]=\"source.srcset\"\n          [attr.media]=\"source.media\"\n          [attr.sizes]=\"source.sizes\"\n          [attr.type]=\"source.type\"\n        />\n        <img\n          [src]=\"item.src\"\n          [alt]=\"item.alt\"\n          [attr.loading]=\"loading\"\n          [style.objectFit]=\"objectFit\"\n        />\n      </picture>\n      <!-- Using loadedmetadata instead of loadeddata because iOS loads data lazily upon user's interaction -->\n      <video\n        *ngIf=\"!isYoutube(item) && item.video\"\n        @mediaAnimate\n        [src]=\"item.src\"\n        [poster]=\"item.thumbSrc || ''\"\n        [attr.preload]=\"loading === 'lazy' ? 'metadata' : 'auto'\"\n        [style.objectFit]=\"objectFit\"\n        controls\n        playsinline\n      ></video>\n\n      <iframe\n        *ngIf=\"isYoutube(item)\"\n        @mediaAnimate\n        [attr.loading]=\"loading\"\n        [src]=\"item.src | safe\"\n        allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n        allowfullscreen\n      ></iframe>\n    </ng-container>\n\n    <ng-container *ngIf=\"itemFailedToLoad(item)\">\n      <div\n        *ngIf=\"!errorTemplate; else $any(errorTemplate)\"\n        class=\"viewer-error\"\n      >\n        <div class=\"viewer-error-icon\">\u26A0</div>\n        <p class=\"viewer-error-text\">\n          {{ errorText || 'Loading of this media failed' }}\n        </p>\n      </div>\n    </ng-container>\n\n    <span\n      [id]=\"'viewer-aria-description-' + i\"\n      class=\"sr-only\"\n      [innerHTML]=\"item.description\"\n    ></span>\n\n    <ng-template #customTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          $any(itemTemplate);\n          context: {\n            index: items?.indexOf(item),\n            selectedIndex: selectedIndex,\n            item: item,\n            video: item.video\n          }\n        \"\n      ></ng-container>\n    </ng-template>\n  </li>\n</ul>\n\n<button\n  *ngIf=\"showNextArrow\"\n  aria-label=\"Next image\"\n  class=\"viewer-arrow viewer-arrow-next\"\n  (mousedown)=\"$event.stopPropagation()\"\n  (click)=\"selectByDelta(moveByItems)\"\n>\n  <chevron-icon *ngIf=\"!arrowTemplate; else $any(arrowTemplate)\"></chevron-icon>\n</button>\n\n<counter\n  *ngIf=\"counter && items.length\"\n  [itemQuantity]=\"items.length\"\n  [selectedIndex]=\"counterIndex\"\n  [orientation]=\"counterOrientation\"\n></counter>\n\n<ng-container\n  *ngTemplateOutlet=\"\n    $any(contentTemplate);\n    context: {\n      selectedIndex: selectedIndex\n    }\n  \"\n></ng-container>\n\n<div\n  *ngIf=\"descriptions && items\"\n  class=\"viewer-description\"\n  [class.viewer-description--above-counter]=\"\n    counter && counterOrientation === 'bottom'\n  \"\n  aria-hidden=\"true\"\n>\n  <div\n    *ngIf=\"items[selectedIndex]?.description as description\"\n    class=\"viewer-description-inner\"\n    [innerHTML]=\"description\"\n    (click)=\"descriptionClick.emit($event)\"\n  ></div>\n</div>\n", styles: [":host{display:block;position:relative;width:100%;height:100%;outline:none;z-index:1}:host.clip{overflow:hidden}:host.rtl .viewer-arrow-next{right:auto;left:0;transform:translateY(-50%) scale(-1)}:host.rtl .viewer-arrow-prev{right:0;left:auto;transform:translateY(-50%)}ul{--item-width: 100%;display:flex;width:100%;height:100%;transition:transform;scrollbar-width:none}ul::-webkit-scrollbar{width:0;height:0}li{display:flex;align-items:center;flex:none;position:relative;width:var(--item-width);-webkit-user-select:none;user-select:none;outline:0}picture{width:100%;height:100%}img,video,iframe{width:100%;height:100%;background-color:transparent;outline:0;color:transparent}iframe{border:0}img{-webkit-user-select:none;user-select:none}.viewer-description{position:absolute;bottom:.5rem;width:100%;display:flex;justify-content:center;font-size:.9rem}.viewer-description--above-counter{bottom:2.5rem}.viewer-description-inner{display:inline-block;background:rgba(0,0,0,.7);color:#f1f5f9;padding:.5rem .75rem;max-width:80%;text-align:center;border-radius:.5rem}.viewer-error{position:absolute;left:0;top:0;width:100%;height:100%;display:flex;flex-flow:column nowrap;justify-content:center;align-items:center;background-color:#f5f5f5;color:#7d7d7d}.viewer-error-icon{font-size:40px}.viewer-error-text{margin-top:10px;letter-spacing:.01em}.viewer-arrow{display:flex;position:absolute;top:50%;padding:0;background-color:transparent;transform:translateY(-50%);z-index:100;cursor:pointer}.viewer-arrow-prev{left:0;transform:scale(-1) translateY(50%)}.viewer-arrow-next{right:0}.viewer-arrow chevron-icon{margin:15px 6px;opacity:.7}@media (hover: hover) and (pointer: fine){.viewer-arrow chevron-icon:hover{opacity:1}}.viewer-arrow chevron-icon::ng-deep svg{height:32px;width:32px}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "component", type: CounterComponent, selector: "counter", inputs: ["itemQuantity", "selectedIndex", "orientation"] }, { kind: "component", type: ChevronIconComponent, selector: "chevron-icon" }, { kind: "directive", type: MediaDirective, selector: "[media]", outputs: ["mediaLoadError"] }, { kind: "pipe", type: SafePipe, name: "safe" }], animations: [
            trigger('mediaAnimate', [
                transition(':leave', animate('0ms 100ms')),
                transition(':enter', [
                    style({ opacity: 0 }),
                    animate('400ms', style({ opacity: 1 })),
                ]),
            ]),
        ], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.8", ngImport: i0, type: ViewerComponent, decorators: [{
            type: Component,
            args: [{ selector: 'viewer', changeDetection: ChangeDetectionStrategy.OnPush, animations: [
                        trigger('mediaAnimate', [
                            transition(':leave', animate('0ms 100ms')),
                            transition(':enter', [
                                style({ opacity: 0 }),
                                animate('400ms', style({ opacity: 1 })),
                            ]),
                        ]),
                    ], standalone: true, imports: [
                        CommonModule,
                        CounterComponent,
                        ChevronIconComponent,
                        MediaDirective,
                        SafePipe,
                    ], template: "<button\n  *ngIf=\"showPrevArrow\"\n  aria-label=\"Previous image\"\n  class=\"viewer-arrow viewer-arrow-prev\"\n  (mousedown)=\"$event.stopPropagation()\"\n  (click)=\"selectByDelta(-moveByItems)\"\n>\n  <chevron-icon *ngIf=\"!arrowTemplate; else $any(arrowTemplate)\"></chevron-icon>\n</button>\n\n<ul #itemList [attr.aria-label]=\"aria?.viewerLabel\">\n  <li *ngIf=\"!displayedItems?.length\" class=\"viewer-initial-item\"></li>\n  <li\n    #itemsRef\n    *ngFor=\"let item of displayedItems; let i = index\"\n    media\n    [attr.tabindex]=\"itemTabbable(i)\"\n    [attr.aria-label]=\"item.alt\"\n    [attr.aria-describedby]=\"'viewer-aria-description-' + i\"\n    (click)=\"onImageClick(item, $event)\"\n    (mediaLoadError)=\"onItemErrored(item)\"\n    (keydown.Tab)=\"onTab(i + 1)\"\n    (keydown.shift.Tab)=\"onTab(i - 1)\"\n  >\n    <ng-container *ngIf=\"!itemTemplate; else customTemplate\">\n      <picture *ngIf=\"!item.video\" @mediaAnimate>\n        <source\n          *ngFor=\"let source of item.pictureSources\"\n          [srcset]=\"source.srcset\"\n          [attr.media]=\"source.media\"\n          [attr.sizes]=\"source.sizes\"\n          [attr.type]=\"source.type\"\n        />\n        <img\n          [src]=\"item.src\"\n          [alt]=\"item.alt\"\n          [attr.loading]=\"loading\"\n          [style.objectFit]=\"objectFit\"\n        />\n      </picture>\n      <!-- Using loadedmetadata instead of loadeddata because iOS loads data lazily upon user's interaction -->\n      <video\n        *ngIf=\"!isYoutube(item) && item.video\"\n        @mediaAnimate\n        [src]=\"item.src\"\n        [poster]=\"item.thumbSrc || ''\"\n        [attr.preload]=\"loading === 'lazy' ? 'metadata' : 'auto'\"\n        [style.objectFit]=\"objectFit\"\n        controls\n        playsinline\n      ></video>\n\n      <iframe\n        *ngIf=\"isYoutube(item)\"\n        @mediaAnimate\n        [attr.loading]=\"loading\"\n        [src]=\"item.src | safe\"\n        allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"\n        allowfullscreen\n      ></iframe>\n    </ng-container>\n\n    <ng-container *ngIf=\"itemFailedToLoad(item)\">\n      <div\n        *ngIf=\"!errorTemplate; else $any(errorTemplate)\"\n        class=\"viewer-error\"\n      >\n        <div class=\"viewer-error-icon\">\u26A0</div>\n        <p class=\"viewer-error-text\">\n          {{ errorText || 'Loading of this media failed' }}\n        </p>\n      </div>\n    </ng-container>\n\n    <span\n      [id]=\"'viewer-aria-description-' + i\"\n      class=\"sr-only\"\n      [innerHTML]=\"item.description\"\n    ></span>\n\n    <ng-template #customTemplate>\n      <ng-container\n        *ngTemplateOutlet=\"\n          $any(itemTemplate);\n          context: {\n            index: items?.indexOf(item),\n            selectedIndex: selectedIndex,\n            item: item,\n            video: item.video\n          }\n        \"\n      ></ng-container>\n    </ng-template>\n  </li>\n</ul>\n\n<button\n  *ngIf=\"showNextArrow\"\n  aria-label=\"Next image\"\n  class=\"viewer-arrow viewer-arrow-next\"\n  (mousedown)=\"$event.stopPropagation()\"\n  (click)=\"selectByDelta(moveByItems)\"\n>\n  <chevron-icon *ngIf=\"!arrowTemplate; else $any(arrowTemplate)\"></chevron-icon>\n</button>\n\n<counter\n  *ngIf=\"counter && items.length\"\n  [itemQuantity]=\"items.length\"\n  [selectedIndex]=\"counterIndex\"\n  [orientation]=\"counterOrientation\"\n></counter>\n\n<ng-container\n  *ngTemplateOutlet=\"\n    $any(contentTemplate);\n    context: {\n      selectedIndex: selectedIndex\n    }\n  \"\n></ng-container>\n\n<div\n  *ngIf=\"descriptions && items\"\n  class=\"viewer-description\"\n  [class.viewer-description--above-counter]=\"\n    counter && counterOrientation === 'bottom'\n  \"\n  aria-hidden=\"true\"\n>\n  <div\n    *ngIf=\"items[selectedIndex]?.description as description\"\n    class=\"viewer-description-inner\"\n    [innerHTML]=\"description\"\n    (click)=\"descriptionClick.emit($event)\"\n  ></div>\n</div>\n", styles: [":host{display:block;position:relative;width:100%;height:100%;outline:none;z-index:1}:host.clip{overflow:hidden}:host.rtl .viewer-arrow-next{right:auto;left:0;transform:translateY(-50%) scale(-1)}:host.rtl .viewer-arrow-prev{right:0;left:auto;transform:translateY(-50%)}ul{--item-width: 100%;display:flex;width:100%;height:100%;transition:transform;scrollbar-width:none}ul::-webkit-scrollbar{width:0;height:0}li{display:flex;align-items:center;flex:none;position:relative;width:var(--item-width);-webkit-user-select:none;user-select:none;outline:0}picture{width:100%;height:100%}img,video,iframe{width:100%;height:100%;background-color:transparent;outline:0;color:transparent}iframe{border:0}img{-webkit-user-select:none;user-select:none}.viewer-description{position:absolute;bottom:.5rem;width:100%;display:flex;justify-content:center;font-size:.9rem}.viewer-description--above-counter{bottom:2.5rem}.viewer-description-inner{display:inline-block;background:rgba(0,0,0,.7);color:#f1f5f9;padding:.5rem .75rem;max-width:80%;text-align:center;border-radius:.5rem}.viewer-error{position:absolute;left:0;top:0;width:100%;height:100%;display:flex;flex-flow:column nowrap;justify-content:center;align-items:center;background-color:#f5f5f5;color:#7d7d7d}.viewer-error-icon{font-size:40px}.viewer-error-text{margin-top:10px;letter-spacing:.01em}.viewer-arrow{display:flex;position:absolute;top:50%;padding:0;background-color:transparent;transform:translateY(-50%);z-index:100;cursor:pointer}.viewer-arrow-prev{left:0;transform:scale(-1) translateY(50%)}.viewer-arrow-next{right:0}.viewer-arrow chevron-icon{margin:15px 6px;opacity:.7}@media (hover: hover) and (pointer: fine){.viewer-arrow chevron-icon:hover{opacity:1}}.viewer-arrow chevron-icon::ng-deep svg{height:32px;width:32px}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }, { type: i0.DestroyRef }, { type: i0.NgZone }]; }, propDecorators: { items: [{
                type: Input
            }], selectedIndex: [{
                type: Input
            }], arrows: [{
                type: Input
            }], descriptions: [{
                type: Input
            }], errorText: [{
                type: Input
            }], showErrors: [{
                type: Input
            }], mouseGestures: [{
                type: Input
            }], touchGestures: [{
                type: Input
            }], counter: [{
                type: Input
            }], counterOrientation: [{
                type: Input
            }], loading: [{
                type: Input
            }], objectFit: [{
                type: Input
            }], itemTemplate: [{
                type: Input
            }], errorTemplate: [{
                type: Input
            }], arrowTemplate: [{
                type: Input
            }], contentTemplate: [{
                type: Input
            }], thumbsOrientation: [{
                type: Input
            }], aria: [{
                type: Input
            }], loop: [{
                type: Input
            }], visibleItems: [{
                type: Input
            }], moveByItems: [{
                type: Input
            }], clip: [{
                type: HostBinding,
                args: ['class.clip']
            }, {
                type: Input
            }], isRtl: [{
                type: HostBinding,
                args: ['class.rtl']
            }, {
                type: Input
            }], itemClick: [{
                type: Output
            }], descriptionClick: [{
                type: Output
            }], selection: [{
                type: Output
            }], itemListRef: [{
                type: ViewChild,
                args: ['itemList', { static: true }]
            }], itemsRef: [{
                type: ViewChildren,
                args: ['itemsRef']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlld2VyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvZ2FsbGVyeS9zcmMvbGliL2NvbXBvbmVudHMvdmlld2VyL3ZpZXdlci5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9saWJzL2dhbGxlcnkvc3JjL2xpYi9jb21wb25lbnRzL3ZpZXdlci92aWV3ZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBRUwsdUJBQXVCLEVBRXZCLFNBQVMsRUFHVCxZQUFZLEVBQ1osV0FBVyxFQUNYLEtBQUssRUFJTCxNQUFNLEVBSU4sU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBUUwsRUFBRSxFQUVGLFNBQVMsR0FDVixNQUFNLFlBQVksQ0FBQztBQUVwQixPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDbEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2pELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDOzs7QUFFL0UsTUFBTSx3QkFBd0IsR0FBRztJQUMvQixPQUFPLEVBQUUsSUFBSTtDQUNkLENBQUM7QUF5QkYsTUFBTSxPQUFPLGVBQWU7SUErQzFCLElBQUksV0FBVyxDQUFDLEtBQWM7UUFDNUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLGtCQUFrQixHQUFHLEtBQUs7WUFDN0QsQ0FBQyxDQUFDLEtBQUs7WUFD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QkFDZCxRQUFRO3FCQUNUOytLQUdRLEtBQUs7c0JBQWIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLE1BQU07c0JBQWQsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0csVUFBVTtzQkFBbEIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csT0FBTztzQkFBZixLQUFLO2dCQUNHLGtCQUFrQjtzQkFBMUIsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxZQUFZO3NCQUFwQixLQUFLO2dCQUNHLGFBQWE7c0JBQXJCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxlQUFlO3NCQUF2QixLQUFLO2dCQUNHLGlCQUFpQjtzQkFBekIsS0FBSztnQkFDRyxJQUFJO3NCQUFaLEtBQUs7Z0JBQ0csSUFBSTtzQkFBWixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBQ0csV0FBVztzQkFBbkIsS0FBSztnQkFJTixJQUFJO3NCQUZILFdBQVc7dUJBQUMsWUFBWTs7c0JBQ3hCLEtBQUs7Z0JBS04sS0FBSztzQkFGSixXQUFXO3VCQUFDLFdBQVc7O3NCQUN2QixLQUFLO2dCQUdJLFNBQVM7c0JBQWxCLE1BQU07Z0JBQ0csZ0JBQWdCO3NCQUF6QixNQUFNO2dCQUNHLFNBQVM7c0JBQWxCLE1BQU07Z0JBR1AsV0FBVztzQkFEVixTQUFTO3VCQUFDLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBRWIsUUFBUTtzQkFBakMsWUFBWTt1QkFBQyxVQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYW5pbWF0ZSwgc3R5bGUsIHRyYW5zaXRpb24sIHRyaWdnZXIgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcbmltcG9ydCB7IENvbW1vbk1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuICBBZnRlclZpZXdJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRGVzdHJveVJlZixcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIE5nWm9uZSxcbiAgT25DaGFuZ2VzLFxuICBPbkluaXQsXG4gIE91dHB1dCxcbiAgUXVlcnlMaXN0LFxuICBTaW1wbGVDaGFuZ2VzLFxuICBUZW1wbGF0ZVJlZixcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgQXJpYSxcbiAgQ29udGVudFRlbXBsYXRlQ29udGV4dCxcbiAgR2FsbGVyeUl0ZW1FdmVudCxcbiAgSXRlbVRlbXBsYXRlQ29udGV4dCxcbiAgTG9hZGluZyxcbiAgT2JqZWN0Rml0LFxuICBPcmllbnRhdGlvbkZsYWcsXG4gIFVBLFxuICBWZXJ0aWNhbE9yaWVudGF0aW9uLFxuICBpc0Jyb3dzZXIsXG59IGZyb20gJy4uLy4uL2NvcmUnO1xuaW1wb3J0IHsgR2FsbGVyeUl0ZW1JbnRlcm5hbCB9IGZyb20gJy4uLy4uL2NvcmUvZ2FsbGVyeS1pdGVtJztcbmltcG9ydCB7IE1lZGlhRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vZGlyZWN0aXZlcy9tZWRpYS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgU2FmZVBpcGUgfSBmcm9tICcuLi8uLi9waXBlcy9zYWZlLnBpcGUnO1xuaW1wb3J0IHsgQ291bnRlckNvbXBvbmVudCB9IGZyb20gJy4uL2NvdW50ZXIvY291bnRlci5jb21wb25lbnQnO1xuaW1wb3J0IHsgQ2hldnJvbkljb25Db21wb25lbnQgfSBmcm9tICcuLi9pY29ucy9jaGV2cm9uL2NoZXZyb24taWNvbi5jb21wb25lbnQnO1xuXG5jb25zdCBwYXNzaXZlRXZlbnRMaXN0ZW5lck9wdHMgPSB7XG4gIHBhc3NpdmU6IHRydWUsXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICd2aWV3ZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vdmlld2VyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdmlld2VyLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignbWVkaWFBbmltYXRlJywgW1xuICAgICAgdHJhbnNpdGlvbignOmxlYXZlJywgYW5pbWF0ZSgnMG1zIDEwMG1zJykpLFxuICAgICAgdHJhbnNpdGlvbignOmVudGVyJywgW1xuICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAgfSksXG4gICAgICAgIGFuaW1hdGUoJzQwMG1zJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgICAgIF0pLFxuICAgIF0pLFxuICBdLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQ29tbW9uTW9kdWxlLFxuICAgIENvdW50ZXJDb21wb25lbnQsXG4gICAgQ2hldnJvbkljb25Db21wb25lbnQsXG4gICAgTWVkaWFEaXJlY3RpdmUsXG4gICAgU2FmZVBpcGUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFZpZXdlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcywgT25Jbml0LCBBZnRlclZpZXdJbml0IHtcbiAgQElucHV0KCkgaXRlbXMhOiBHYWxsZXJ5SXRlbUludGVybmFsW107XG4gIEBJbnB1dCgpIHNlbGVjdGVkSW5kZXghOiBudW1iZXI7XG4gIEBJbnB1dCgpIGFycm93cz86IGJvb2xlYW47XG4gIEBJbnB1dCgpIGRlc2NyaXB0aW9ucz86IGJvb2xlYW47XG4gIEBJbnB1dCgpIGVycm9yVGV4dD86IHN0cmluZztcbiAgQElucHV0KCkgc2hvd0Vycm9ycz86IGJvb2xlYW47XG4gIEBJbnB1dCgpIG1vdXNlR2VzdHVyZXM/OiBib29sZWFuO1xuICBASW5wdXQoKSB0b3VjaEdlc3R1cmVzPzogYm9vbGVhbjtcbiAgQElucHV0KCkgY291bnRlcj86IGJvb2xlYW47XG4gIEBJbnB1dCgpIGNvdW50ZXJPcmllbnRhdGlvbiE6IFZlcnRpY2FsT3JpZW50YXRpb247XG4gIEBJbnB1dCgpIGxvYWRpbmc/OiBMb2FkaW5nO1xuICBASW5wdXQoKSBvYmplY3RGaXQ/OiBPYmplY3RGaXQ7XG4gIEBJbnB1dCgpIGl0ZW1UZW1wbGF0ZT86IFRlbXBsYXRlUmVmPEl0ZW1UZW1wbGF0ZUNvbnRleHQ+O1xuICBASW5wdXQoKSBlcnJvclRlbXBsYXRlPzogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgYXJyb3dUZW1wbGF0ZT86IFRlbXBsYXRlUmVmPGFueT47XG4gIEBJbnB1dCgpIGNvbnRlbnRUZW1wbGF0ZT86IFRlbXBsYXRlUmVmPENvbnRlbnRUZW1wbGF0ZUNvbnRleHQ+O1xuICBASW5wdXQoKSB0aHVtYnNPcmllbnRhdGlvbj86IE9yaWVudGF0aW9uRmxhZztcbiAgQElucHV0KCkgYXJpYT86IEFyaWE7XG4gIEBJbnB1dCgpIGxvb3A/OiBib29sZWFuO1xuICBASW5wdXQoKSB2aXNpYmxlSXRlbXMhOiBudW1iZXI7XG4gIEBJbnB1dCgpIG1vdmVCeUl0ZW1zITogbnVtYmVyO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuY2xpcCcpXG4gIEBJbnB1dCgpXG4gIGNsaXA/OiBib29sZWFuO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MucnRsJylcbiAgQElucHV0KClcbiAgaXNSdGw/OiBib29sZWFuO1xuXG4gIEBPdXRwdXQoKSBpdGVtQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPEdhbGxlcnlJdGVtRXZlbnQ+KCk7XG4gIEBPdXRwdXQoKSBkZXNjcmlwdGlvbkNsaWNrID0gbmV3IEV2ZW50RW1pdHRlcjxFdmVudD4oKTtcbiAgQE91dHB1dCgpIHNlbGVjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ2l0ZW1MaXN0JywgeyBzdGF0aWM6IHRydWUgfSlcbiAgaXRlbUxpc3RSZWYhOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PjtcbiAgQFZpZXdDaGlsZHJlbignaXRlbXNSZWYnKSBpdGVtc1JlZiE6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPEhUTUxFbGVtZW50Pj47XG5cbiAgZGlzcGxheWVkSXRlbXM/OiBHYWxsZXJ5SXRlbUludGVybmFsW107XG4gIGZyaW5nZUNvdW50ID0gdGhpcy5nZXRGcmluZ2VDb3VudCgpO1xuICByZWFsbHlMb29wPzogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfaXRlbVdpZHRoID0gMDtcbiAgcHJpdmF0ZSBmcmluZ2VPYnNlcnZlcj86IEludGVyc2VjdGlvbk9ic2VydmVyO1xuICBwcml2YXRlIHBvaW50ZXJEZWx0YVggPSAwO1xuICBwcml2YXRlIHNsaWRpbmcgPSBmYWxzZTtcblxuICBzZXQgbm9BbmltYXRpb24odmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLml0ZW1MaXN0UmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbkR1cmF0aW9uID0gdmFsdWVcbiAgICAgID8gJzBtcydcbiAgICAgIDogJzQwMG1zJztcbiAgfVxuXG4gIGdldCBjb3VudGVySW5kZXgoKSB7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IodGhpcy5zZWxlY3RlZEluZGV4IC8gdGhpcy5tb3ZlQnlJdGVtcyk7XG4gIH1cblxuICBnZXQgc2hvd0Fycm93KCkge1xuICAgIHJldHVybiB0aGlzLmFycm93cyAmJiB0aGlzLml0ZW1zICYmIHRoaXMuaXRlbXMubGVuZ3RoID4gMTtcbiAgfVxuXG4gIGdldCBzaG93UHJldkFycm93KCkge1xuICAgIHJldHVybiB0aGlzLnNob3dBcnJvdyAmJiAodGhpcy5zZWxlY3RlZEluZGV4ID4gMCB8fCB0aGlzLnJlYWxseUxvb3ApO1xuICB9XG5cbiAgZ2V0IHNob3dOZXh0QXJyb3coKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuc2hvd0Fycm93ICYmXG4gICAgICAodGhpcy5zZWxlY3RlZEluZGV4IDwgdGhpcy5pdGVtcy5sZW5ndGggLSAxIHx8IHRoaXMucmVhbGx5TG9vcClcbiAgICApO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfaG9zdFJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sXG4gICAgcHJpdmF0ZSBfY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgX2Rlc3Ryb3lSZWY6IERlc3Ryb3lSZWYsXG4gICAgcHJpdmF0ZSBfem9uZTogTmdab25lXG4gICkge31cblxuICBuZ09uQ2hhbmdlcyh7IHZpc2libGVJdGVtcywgaXRlbXMsIGxvb3AgfTogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmICh2aXNpYmxlSXRlbXMpIHtcbiAgICAgIHRoaXMuaXRlbUxpc3RSZWYubmF0aXZlRWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcbiAgICAgICAgJy0taXRlbS13aWR0aCcsXG4gICAgICAgIGBjYWxjKDEwMCUgLyAke3RoaXMudmlzaWJsZUl0ZW1zfSlgXG4gICAgICApO1xuICAgICAgc2V0VGltZW91dCh0aGlzLnVwZGF0ZURpbWVuc2lvbnMpO1xuICAgIH1cbiAgICBpZiAobG9vcCB8fCBpdGVtcykge1xuICAgICAgdGhpcy5yZWFsbHlMb29wID0gdGhpcy5pdGVtcy5sZW5ndGggPiAxID8gdGhpcy5sb29wIDogZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLnJlYWxseUxvb3ApIHtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLm9ic2VydmVGcmluZ2VzKCkpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaXRlbXMgfHwgdmlzaWJsZUl0ZW1zIHx8IGxvb3ApIHtcbiAgICAgIHRoaXMuZnJpbmdlQ291bnQgPSB0aGlzLmdldEZyaW5nZUNvdW50KCk7XG4gICAgICB0aGlzLmRpc3BsYXllZEl0ZW1zID0gdGhpcy5nZXRJdGVtc1RvQmVEaXNwbGF5ZWQodGhpcy5mcmluZ2VDb3VudCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKGlzQnJvd3Nlcikge1xuICAgICAgdGhpcy5oYW5kbGVSZXNpemVzKCk7XG5cbiAgICAgIGlmICh0aGlzLm1vdXNlR2VzdHVyZXMpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVNb3VzZVNsaWRlcygpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy50b3VjaEdlc3R1cmVzKSB7XG4gICAgICAgIHRoaXMuaGFuZGxlVG91Y2hTbGlkZXMoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2Rlc3Ryb3lSZWYub25EZXN0cm95KCgpID0+IHRoaXMuZnJpbmdlT2JzZXJ2ZXI/LmRpc2Nvbm5lY3QoKSk7XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuY2VudGVyKCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiAodGhpcy5ub0FuaW1hdGlvbiA9IGZhbHNlKSk7XG4gIH1cblxuICBpc1lvdXR1YmUoaXRlbTogR2FsbGVyeUl0ZW1JbnRlcm5hbCkge1xuICAgIHJldHVybiAhIWl0ZW0uc3JjLm1hdGNoKC95b3V0dWJlLipcXC9lbWJlZFxcLy8pO1xuICB9XG5cbiAgc2VsZWN0KGluZGV4OiBudW1iZXIsIHNob3J0UGF0aCA9IHRydWUpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZEluZGV4ID09PSBpbmRleCkge1xuICAgICAgcmV0dXJuIHRoaXMuY2VudGVyKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXRlbXNbdGhpcy5zZWxlY3RlZEluZGV4XT8udmlkZW8pIHtcbiAgICAgIHRoaXMuc3RvcEN1cnJlbnRWaWRlbygpO1xuICAgIH1cblxuICAgIC8vIFRoZSBwdXJwb3NlIG9mIHRoZSBzaG9ydCBwYXRoIGhlcmUgaXMgYmVzdCB1bmRlcnN0b29kIGJ5IHRoZSBmb2xsb3dpbmcgZXhhbXBsZTogSWYgZ29pbmcgZnJvbSBpbmRleFxuICAgIC8vIDYgKGxhc3QpIHRvIGluZGV4IDAsIGRvIG5vdCBnbyBiYWNrIG92ZXIgYWxsIHRoZSBtaWRkbGUgaXRlbXMsIGJ1dCBnbyA2IC0+IDAgdGhlIHNob3J0IHJvdXRlLiBUaGlzXG4gICAgLy8gbWFrZXMgbmF2aWdhdGluZyBzbGlkZXIgc21vb3RoZXIuIFRoaXMgb2YgY291cnNlIGFwcGxpZXMgaW4gdGhlIG90aGVyIGRpcmVjdGlvbiBhcyB3ZWxsLlxuICAgIGlmICh0aGlzLnZpc2libGVJdGVtcyA+IDEgJiYgc2hvcnRQYXRoKSB7XG4gICAgICBjb25zdCBtYXhJbmRleCA9IHRoaXMuaXRlbXMubGVuZ3RoIC0gdGhpcy52aXNpYmxlSXRlbXM7XG4gICAgICAvLyBXaGVuIGdvaW5nIGJhY2ssIGluIGRpcmVjdGlvbiBvdmVyIHRoZSBmaXJzdCBpdGVtLCBzdG9wIGF0IHRoZSBzbGlkZXIncyBiZWdpbm5pbmcgYXQgZmlyc3QuXG4gICAgICBpZiAodGhpcy5zZWxlY3RlZEluZGV4ICE9PSAwICYmIGluZGV4IDwgMCkge1xuICAgICAgICBpbmRleCA9IDA7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuc2VsZWN0ZWRJbmRleCA8IG1heEluZGV4KSB7XG4gICAgICAgIC8vIFNldCB0aGUgZGVzaXJlZCBpbmRleCBvciBjaG9vc2UgdGhlIGxhc3QgaWYgaXQgaXMgdGhlIHNsaWRlcidzIGxhc3QgXCJwYWdlXCIuXG4gICAgICAgIGluZGV4ID0gTWF0aC5taW4obWF4SW5kZXgsIGluZGV4KTtcbiAgICAgIH0gZWxzZSBpZiAoaW5kZXggPiBtYXhJbmRleCkge1xuICAgICAgICAvLyBMb29wIHRvIHRoZSBmaXJzdCBpdGVtIGlmIGdvaW5nIG92ZXIgdGhlIHNsaWRlcidzIGVuZC4gVGhpcyB0cmljayBtYWtlcyB0aGUgbG9vcCBjcm9zcyB0aGVcbiAgICAgICAgLy8gYm91bmRhcnkgYmV0d2VlbiB0aGUgbGFzdCBhbmQgdGhlIGZpcnN0LlxuICAgICAgICBpbmRleCA9IHRoaXMuaXRlbXMubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGluZGV4T3V0T2ZCb3VuZHMgPSAhdGhpcy5pdGVtc1tpbmRleF07XG4gICAgY29uc3QgbG9vcGluZyA9IHRoaXMucmVhbGx5TG9vcCAmJiBpbmRleE91dE9mQm91bmRzO1xuXG4gICAgaWYgKGxvb3BpbmcpIHtcbiAgICAgIHRoaXMubG9vcFRvKGluZGV4KTtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbi5lbWl0KHRoaXMuc2VsZWN0ZWRJbmRleCk7XG4gICAgfVxuXG4gICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gaW5kZXhPdXRPZkJvdW5kc1xuICAgICAgPyB0aGlzLmNvcnJlY3RJbmRleE91dE9mQm91bmRzKGluZGV4KVxuICAgICAgOiBpbmRleDtcblxuICAgIHRoaXMuY2VudGVyKCk7IC8vIHdlIGNlbnRlciBvbmx5IGZvciB0aGlzIGJyYW5jaCBzaW5jZSBsb29waW5nIGRvZXMgYSBkZWxheWVkIGNlbnRlcmluZ1xuICAgIHRoaXMuc2VsZWN0aW9uLmVtaXQodGhpcy5zZWxlY3RlZEluZGV4KTtcbiAgfVxuXG4gIHNlbGVjdEJ5RGVsdGEoZGVsdGE6IG51bWJlcikge1xuICAgIHRoaXMuc2VsZWN0KHRoaXMuc2VsZWN0ZWRJbmRleCArIGRlbHRhKTtcbiAgfVxuXG4gIG9uSW1hZ2VDbGljayhpdGVtOiBHYWxsZXJ5SXRlbUludGVybmFsLCBldmVudDogRXZlbnQpIHtcbiAgICB0aGlzLml0ZW1DbGljay5lbWl0KHtcbiAgICAgIGV2ZW50LFxuICAgICAgaXRlbSxcbiAgICAgIGluZGV4OiB0aGlzLml0ZW1zLmluZGV4T2YoaXRlbSksXG4gICAgfSk7XG4gIH1cblxuICBvblRhYihuZXh0SXRlbUluZGV4OiBudW1iZXIpIHtcbiAgICBuZXh0SXRlbUluZGV4ID0gbmV4dEl0ZW1JbmRleCAtIHRoaXMuZnJpbmdlQ291bnQ7XG4gICAgLy8gYWxsb3cgZm9jdXMgdG8gZXNjYXBlIHZpZXdlclxuICAgIGlmIChuZXh0SXRlbUluZGV4ID49IDAgJiYgbmV4dEl0ZW1JbmRleCA8IHRoaXMuaXRlbXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnNlbGVjdChuZXh0SXRlbUluZGV4KTtcbiAgICAgIC8vIGZvY3VzaW5nIGFuIGl0ZW0gbGl0ZXJhbGx5IHNjcm9sbHMgdGhlIGl0ZW0gbGlzdCwgc28gSSBoYXZlIHRvIHNjcm9sbCBpdCBiYWNrXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gKHRoaXMuX2hvc3RSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxMZWZ0ID0gMCkpO1xuICAgIH1cbiAgfVxuXG4gIG9uSXRlbUVycm9yZWQoaXRlbTogR2FsbGVyeUl0ZW1JbnRlcm5hbCkge1xuICAgIGlmICghdGhpcy5zaG93RXJyb3JzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGl0ZW0uX2ZhaWxlZCA9IHRydWU7XG4gICAgdGhpcy5fY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgaXRlbUZhaWxlZFRvTG9hZChpdGVtOiBHYWxsZXJ5SXRlbUludGVybmFsKSB7XG4gICAgcmV0dXJuIGl0ZW0uX2ZhaWxlZDtcbiAgfVxuXG4gIGl0ZW1UYWJiYWJsZShpbmRleDogbnVtYmVyKSB7XG4gICAgaW5kZXggPSBpbmRleCAtIHRoaXMuZnJpbmdlQ291bnQ7XG4gICAgcmV0dXJuIGluZGV4ID49IDAgJiYgaW5kZXggPCB0aGlzLml0ZW1zLmxlbmd0aCA/IDAgOiAtMTtcbiAgfVxuXG4gIHByaXZhdGUgY2VudGVyKCkge1xuICAgIHRoaXMuc2hpZnQoKTtcbiAgfVxuXG4gIHByaXZhdGUgY29ycmVjdEluZGV4T3V0T2ZCb3VuZHMoaW5kZXg6IG51bWJlcikge1xuICAgIHJldHVybiBpbmRleCA8IDAgPyAwIDogdGhpcy5pdGVtcy5sZW5ndGggLSAxO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGcmluZ2VDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5yZWFsbHlMb29wXG4gICAgICA/IE1hdGgubWluKE1hdGguY2VpbCh0aGlzLnZpc2libGVJdGVtcyksIHRoaXMuaXRlbXMubGVuZ3RoKVxuICAgICAgOiAwO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRJdGVtc1RvQmVEaXNwbGF5ZWQoZnJpbmdlQ291bnQ6IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLnJlYWxseUxvb3BcbiAgICAgID8gW1xuICAgICAgICAgIC4uLnRoaXMuaXRlbXMuc2xpY2UoLWZyaW5nZUNvdW50KSxcbiAgICAgICAgICAuLi50aGlzLml0ZW1zLFxuICAgICAgICAgIC4uLnRoaXMuaXRlbXMuc2xpY2UoMCwgZnJpbmdlQ291bnQpLFxuICAgICAgICBdXG4gICAgICA6IHRoaXMuaXRlbXM7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZU1vdXNlU2xpZGVzKCkge1xuICAgIHRoaXMuX3pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgY29uc3QgaG9zdEVsID0gdGhpcy5faG9zdFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgbGV0IG1vdXNlZG93bjogTW91c2VFdmVudDtcbiAgICAgIGxldCBtYXhEZWx0YVggPSAwO1xuICAgICAgbGV0IG1heERlbHRhWSA9IDA7XG5cbiAgICAgIGNvbnN0IG9ubW91c2Vkb3duID0gKGU6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgbW91c2Vkb3duID0gZTtcbiAgICAgICAgdGhpcy5ub0FuaW1hdGlvbiA9IHRoaXMuc2xpZGluZyA9IHRydWU7XG5cbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAnbW91c2Vtb3ZlJyxcbiAgICAgICAgICBvbm1vdXNlbW92ZSxcbiAgICAgICAgICBwYXNzaXZlRXZlbnRMaXN0ZW5lck9wdHNcbiAgICAgICAgKTtcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAnbW91c2V1cCcsXG4gICAgICAgICAgb25tb3VzZXVwLFxuICAgICAgICAgIHBhc3NpdmVFdmVudExpc3RlbmVyT3B0c1xuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgY29uc3Qgb25tb3VzZW1vdmUgPSAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICBtYXhEZWx0YVggPSBNYXRoLm1heChNYXRoLmFicyhtb3VzZWRvd24ueCAtIGUueCkpO1xuICAgICAgICBtYXhEZWx0YVkgPSBNYXRoLm1heChNYXRoLmFicyhtb3VzZWRvd24ueSAtIGUueSkpO1xuICAgICAgICB0aGlzLnNoaWZ0QnlEZWx0YShlLm1vdmVtZW50WCk7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBvbm1vdXNldXAgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMubm9BbmltYXRpb24gPSB0aGlzLnNsaWRpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fem9uZS5ydW4oKCkgPT4gdGhpcy5zZWxlY3RCeVN3aXBlU3RhdHModGhpcy5wb2ludGVyRGVsdGFYKSk7XG4gICAgICAgIHRoaXMucG9pbnRlckRlbHRhWCA9IDA7XG5cbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25tb3VzZW1vdmUpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgb25tb3VzZXVwKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9uY2xpY2sgPSAoZTogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICBpZiAobWF4RGVsdGFYID4gMTAgfHwgbWF4RGVsdGFZID4gMTApIHtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIC8vIHRvIHByZXZlbnQgcGxheWluZyBhIHZpZGVvIG9uIHN3aXBlXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIG1heERlbHRhWSA9IG1heERlbHRhWCA9IDA7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBvbmRyYWdzdGFydCA9IChlOiBEcmFnRXZlbnQpID0+IGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgaG9zdEVsLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICdtb3VzZWRvd24nLFxuICAgICAgICBvbm1vdXNlZG93bixcbiAgICAgICAgcGFzc2l2ZUV2ZW50TGlzdGVuZXJPcHRzXG4gICAgICApO1xuICAgICAgaG9zdEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25jbGljaywgeyBjYXB0dXJlOiB0cnVlIH0pO1xuICAgICAgaG9zdEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIG9uZHJhZ3N0YXJ0KTtcblxuICAgICAgdGhpcy5fZGVzdHJveVJlZi5vbkRlc3Ryb3koKCkgPT4ge1xuICAgICAgICBob3N0RWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgb25tb3VzZWRvd24pO1xuICAgICAgICBob3N0RWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbmNsaWNrKTtcbiAgICAgICAgaG9zdEVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIG9uZHJhZ3N0YXJ0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBoYW5kbGVUb3VjaFNsaWRlcygpIHtcbiAgICB0aGlzLl96b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgIGNvbnN0IGhvc3RFbCA9IHRoaXMuX2hvc3RSZWYubmF0aXZlRWxlbWVudDtcbiAgICAgIGxldCBob3Jpem9udGFsOiBib29sZWFuIHwgdW5kZWZpbmVkO1xuICAgICAgbGV0IHRvdWNoc3RhcnQ6IFRvdWNoRXZlbnQgfCB1bmRlZmluZWQ7XG4gICAgICBsZXQgbGFzdFRvdWNobW92ZTogVG91Y2hFdmVudCB8IHVuZGVmaW5lZDtcblxuICAgICAgY29uc3Qgb250b3VjaHN0YXJ0ID0gKGU6IFRvdWNoRXZlbnQpID0+IHtcbiAgICAgICAgdG91Y2hzdGFydCA9IGU7XG4gICAgICAgIHRoaXMubm9BbmltYXRpb24gPSB0aGlzLnNsaWRpbmcgPSB0cnVlO1xuICAgICAgfTtcblxuICAgICAgY29uc3Qgb250b3VjaG1vdmUgPSAoZTogVG91Y2hFdmVudCkgPT4ge1xuICAgICAgICBpZiAoIXRvdWNoc3RhcnQgfHwgZS50b3VjaGVzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydFRvdWNoID0gdG91Y2hzdGFydC50b3VjaGVzWzBdO1xuICAgICAgICBjb25zdCBtb3ZlVG91Y2ggPSBlLnRvdWNoZXNbMF07XG5cbiAgICAgICAgaWYgKGhvcml6b250YWwgPT0gbnVsbCkge1xuICAgICAgICAgIGNvbnN0IGRlbHRhWCA9IE1hdGguYWJzKG1vdmVUb3VjaC5jbGllbnRYIC0gc3RhcnRUb3VjaC5jbGllbnRYKTtcbiAgICAgICAgICBjb25zdCBkZWx0YVkgPSBNYXRoLmFicyhtb3ZlVG91Y2guY2xpZW50WSAtIHN0YXJ0VG91Y2guY2xpZW50WSk7XG5cbiAgICAgICAgICBpZiAoZGVsdGFYIHx8IGRlbHRhWSkge1xuICAgICAgICAgICAgaG9yaXpvbnRhbCA9IGRlbHRhWCAqIDEuMiA+PSBkZWx0YVk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGhvcml6b250YWwpIHtcbiAgICAgICAgICB0aGlzLnNoaWZ0QnlEZWx0YShcbiAgICAgICAgICAgIG1vdmVUb3VjaC5jbGllbnRYIC0gKGxhc3RUb3VjaG1vdmUgPz8gdG91Y2hzdGFydCkudG91Y2hlc1swXS5jbGllbnRYXG4gICAgICAgICAgKTtcbiAgICAgICAgICBsYXN0VG91Y2htb3ZlID0gZTtcbiAgICAgICAgICBpZiAoVUEuaW9zKSB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3Qgb250b3VjaGVuZCA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5ub0FuaW1hdGlvbiA9IHRoaXMuc2xpZGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl96b25lLnJ1bigoKSA9PiB0aGlzLnNlbGVjdEJ5U3dpcGVTdGF0cyh0aGlzLnBvaW50ZXJEZWx0YVgpKTtcbiAgICAgICAgdGhpcy5wb2ludGVyRGVsdGFYID0gMDtcblxuICAgICAgICBob3Jpem9udGFsID0gdW5kZWZpbmVkO1xuICAgICAgICB0b3VjaHN0YXJ0ID0gdW5kZWZpbmVkO1xuICAgICAgICBsYXN0VG91Y2htb3ZlID0gdW5kZWZpbmVkO1xuICAgICAgfTtcblxuICAgICAgaG9zdEVsLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICd0b3VjaHN0YXJ0JyxcbiAgICAgICAgb250b3VjaHN0YXJ0LFxuICAgICAgICBwYXNzaXZlRXZlbnRMaXN0ZW5lck9wdHNcbiAgICAgICk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBvbnRvdWNobW92ZSwge1xuICAgICAgICBwYXNzaXZlOiAhVUEuaW9zLFxuICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAndG91Y2hlbmQnLFxuICAgICAgICBvbnRvdWNoZW5kLFxuICAgICAgICBwYXNzaXZlRXZlbnRMaXN0ZW5lck9wdHNcbiAgICAgICk7XG4gICAgICB0aGlzLl9kZXN0cm95UmVmLm9uRGVzdHJveSgoKSA9PiB7XG4gICAgICAgIGhvc3RFbC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgb250b3VjaHN0YXJ0KTtcbiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb250b3VjaG1vdmUpO1xuICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIG9udG91Y2hlbmQpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVJlc2l6ZXMoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAncmVzaXplJyxcbiAgICAgIHRoaXMudXBkYXRlRGltZW5zaW9ucyxcbiAgICAgIHBhc3NpdmVFdmVudExpc3RlbmVyT3B0c1xuICAgICk7XG5cbiAgICB0aGlzLl9kZXN0cm95UmVmLm9uRGVzdHJveSgoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy51cGRhdGVEaW1lbnNpb25zKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgbG9vcFRvKGRlc2lyZWRJbmRleDogbnVtYmVyKSB7XG4gICAgdGhpcy5ub0FuaW1hdGlvbiA9IHRydWU7XG5cbiAgICBjb25zdCBzaGlmdCA9IE1hdGguc2lnbihkZXNpcmVkSW5kZXgpICogdGhpcy5pdGVtcy5sZW5ndGggKiB0aGlzLl9pdGVtV2lkdGg7XG5cbiAgICB0aGlzLnNoaWZ0QnlEZWx0YShzaGlmdCk7XG4gICAgdGhpcy5zZWxlY3RlZEluZGV4ID1cbiAgICAgIGRlc2lyZWRJbmRleCA8IDBcbiAgICAgICAgPyBkZXNpcmVkSW5kZXggKyB0aGlzLml0ZW1zLmxlbmd0aFxuICAgICAgICA6IGRlc2lyZWRJbmRleCAtIHRoaXMuaXRlbXMubGVuZ3RoO1xuXG4gICAgLy8gTk9URTogVGhpcyBpcyBuZWVkZWQgc28gdGhhdCBhbmltYXRpb24gaXMgcmVhY3RpdmF0ZWQgcmVhbGx5IG9ubHkgYWZ0ZXIgdGhlIGxvb3Agc2hpZnRcbiAgICAvLyBoYXBwZW5lZC4gV2l0aG91dCB0aGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lLCB0aGUgc2V0VGltZW91dCBpcyBvZnRlbiBub3QgZW5vdWdoLCBhcyBpdFxuICAgIC8vIGNhbiBoYXBwZW4gc3RpbGwgYmVmb3JlIHRoZSBuZXh0IGZyYW1lIGlzIHBhaW50ZWQsIHdoaWNoIHdvdWxkIGNhdXNlIHRoZSBsb29wIHNoaWZ0XG4gICAgLy8gdG8gYmUgYW5pbWF0ZWQuXG4gICAgLy8gQnV0LCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgaXMgbm90IGVub3VnaCBhcyBpdHMgY2FsbGJhY2sgaXMgY2FsbGVkIEJFRk9SRSB0aGUgbmV4dCBwYWludCxcbiAgICAvLyBub3QgYWZ0ZXIuIFNlY29uZCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgd291bGQgYWxzbyBiZSBwb3NzaWJsZSwgYnV0IHNldFRpbWVvdXQgaXMgYmV0dGVyXG4gICAgLy8gYXMgaXQncyBjYWxsZWQgcmlnaHQgYWZ0ZXIgdGhlIG5leHQgcGFpbnQgaGFwcGVucy5cbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT5cbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLnBvaW50ZXJEZWx0YVggPSAwO1xuICAgICAgICB0aGlzLm5vQW5pbWF0aW9uID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY2VudGVyKCk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIG9ic2VydmVGcmluZ2VzKCkge1xuICAgIGlmICghaXNCcm93c2VyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZnJpbmdlT2JzZXJ2ZXI/LmRpc2Nvbm5lY3QoKTtcblxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKHRoaXMucmVwb3NpdGlvbk9uRnJpbmdlLCB7XG4gICAgICByb290OiB0aGlzLl9ob3N0UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICB0aHJlc2hvbGQ6IDEuMCxcbiAgICB9KTtcbiAgICBvYnNlcnZlci5vYnNlcnZlKHRoaXMuaXRlbXNSZWYuZmlyc3QubmF0aXZlRWxlbWVudCk7XG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLml0ZW1zUmVmLmxhc3QubmF0aXZlRWxlbWVudCk7XG5cbiAgICB0aGlzLmZyaW5nZU9ic2VydmVyID0gb2JzZXJ2ZXI7XG4gIH1cblxuICBwcml2YXRlIHJlcG9zaXRpb25PbkZyaW5nZTogSW50ZXJzZWN0aW9uT2JzZXJ2ZXJDYWxsYmFjayA9IGVudHJpZXMgPT4ge1xuICAgIGlmICghdGhpcy5yZWFsbHlMb29wIHx8ICF0aGlzLnNsaWRpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgeyBmaXJzdCB9ID0gdGhpcy5pdGVtc1JlZjtcbiAgICBjb25zdCB2aXNpYmxlRW50cmllcyA9IGVudHJpZXMuZmlsdGVyKGUgPT4gZS5pc0ludGVyc2VjdGluZyk7XG5cbiAgICBpZiAodmlzaWJsZUVudHJpZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgYmVnaW5uaW5nVmlzaWJsZSA9IGVudHJpZXNbMF0udGFyZ2V0ID09PSBmaXJzdC5uYXRpdmVFbGVtZW50O1xuXG4gICAgdGhpcy5wb2ludGVyRGVsdGFYICs9XG4gICAgICAoYmVnaW5uaW5nVmlzaWJsZSA/IC0xIDogMSkgKiB0aGlzLml0ZW1zLmxlbmd0aCAqIHRoaXMuX2l0ZW1XaWR0aDtcbiAgfTtcblxuICBwcml2YXRlIHVwZGF0ZURpbWVuc2lvbnMgPSAoKSA9PiB7XG4gICAgdGhpcy5faXRlbVdpZHRoID1cbiAgICAgIHRoaXMuX2hvc3RSZWYubmF0aXZlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdsaScpIS5vZmZzZXRXaWR0aDtcbiAgfTtcblxuICBwcml2YXRlIHNlbGVjdEJ5U3dpcGVTdGF0cyhkaXN0YW5jZTogbnVtYmVyKSB7XG4gICAgLy8gSSB1c2Ugcm91bmQgaW5zdGVhZCBvZiBwcmV2aW91cyBjZWlsIGhlcmUgYmVjYXVzZSB0aGUgY2VpbCB3YXMgcHJldHR5IG9uZS1zaWRlZCBpbiB3aGVyZSB0aGVcbiAgICAvLyBpbmRleCBkZWx0YSB3b3VsZCBtb3ZlLiBUaGlzIHdhcyBhcHBhcmVudCBpbiBsb29waW5nIG1vZGUsIHdoZXJlIGl0ZW1zIHRoYXQgd2VyZSBjbGVhcmx5IHRvIGJlXG4gICAgLy8gc2Nyb2xsZWQgdG8gd2VyZSBhY3R1YWxseSBoaWRkZW4gaW4gZmF2b3Igb2YgaXRlbXMgdGhhdCB3ZXJlIGJhcmVseSB2aXNpYmxlLCBidXQgc2VsZWN0ZWQgdGhhbmtzXG4gICAgLy8gdG8gTWF0aC5jZWlsLlxuICAgIC8vIE5vdyBJIHVzZSBtYWdpY2FsIGNvbnN0YW50IDIuMjUgdG8gbWFrZSBzdXJlIGEgdGlueSBzd2lwZSBzbGlkZXMgdG8gbmV4dCBpdGVtcywgYnV0IHRoZXJlIGlzIHN0aWxsXG4gICAgLy8gYSB0aW55IHRocmVzaG9sZCB0byBtYWtlIHN1cmUgdGhlIHNsaWRlIGRvZXNuJ3QgYWx3YXlzIGhhcHBlbi5cbiAgICBjb25zdCBpbmRleERlbHRhID1cbiAgICAgIE1hdGgucm91bmQoXG4gICAgICAgIChNYXRoLmFicyhkaXN0YW5jZSkgKyB0aGlzLl9pdGVtV2lkdGggLyAyLjI1KSAvIHRoaXMuX2l0ZW1XaWR0aFxuICAgICAgKSAqIC1NYXRoLnNpZ24oZGlzdGFuY2UpO1xuICAgIGNvbnN0IG5ld0luZGV4ID0gdGhpcy5zZWxlY3RlZEluZGV4ICsgaW5kZXhEZWx0YTtcblxuICAgIHRoaXMuc2VsZWN0KG5ld0luZGV4LCBmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNoaWZ0KGRlbHRhID0gMCkge1xuICAgIGNvbnN0IG11bHRpcGxpZXIgPSB0aGlzLmlzUnRsID8gMSA6IC0xO1xuICAgIGNvbnN0IGluZGV4ID0gKHRoaXMuc2VsZWN0ZWRJbmRleCArIHRoaXMuZnJpbmdlQ291bnQpICogbXVsdGlwbGllcjtcbiAgICBkZWx0YSAqPSAtbXVsdGlwbGllcjtcbiAgICBjb25zdCBzaGlmdCA9IGBjYWxjKCR7aW5kZXh9ICogdmFyKC0taXRlbS13aWR0aCkgKyAke2RlbHRhfXB4KWA7XG5cbiAgICB0aGlzLml0ZW1MaXN0UmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZTNkKCR7c2hpZnR9LCAwLCAwKWA7XG4gIH1cblxuICBwcml2YXRlIHNoaWZ0QnlEZWx0YSA9IChkZWx0YTogbnVtYmVyKSA9PiB7XG4gICAgdGhpcy5wb2ludGVyRGVsdGFYICs9IGRlbHRhO1xuICAgIHRoaXMuc2hpZnQodGhpcy5wb2ludGVyRGVsdGFYKTtcbiAgfTtcblxuICBwcml2YXRlIHN0b3BDdXJyZW50VmlkZW8oKSB7XG4gICAgY29uc3QgdmlkZW9FbCA9IHRoaXMuaXRlbXNSZWZcbiAgICAgIC5nZXQodGhpcy5zZWxlY3RlZEluZGV4KVxuICAgICAgPy5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJyk7XG5cbiAgICBpZiAodmlkZW9FbCkge1xuICAgICAgdmlkZW9FbC5wYXVzZSgpO1xuICAgIH1cbiAgfVxufVxuIiwiPGJ1dHRvblxuICAqbmdJZj1cInNob3dQcmV2QXJyb3dcIlxuICBhcmlhLWxhYmVsPVwiUHJldmlvdXMgaW1hZ2VcIlxuICBjbGFzcz1cInZpZXdlci1hcnJvdyB2aWV3ZXItYXJyb3ctcHJldlwiXG4gIChtb3VzZWRvd24pPVwiJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXCJcbiAgKGNsaWNrKT1cInNlbGVjdEJ5RGVsdGEoLW1vdmVCeUl0ZW1zKVwiXG4+XG4gIDxjaGV2cm9uLWljb24gKm5nSWY9XCIhYXJyb3dUZW1wbGF0ZTsgZWxzZSAkYW55KGFycm93VGVtcGxhdGUpXCI+PC9jaGV2cm9uLWljb24+XG48L2J1dHRvbj5cblxuPHVsICNpdGVtTGlzdCBbYXR0ci5hcmlhLWxhYmVsXT1cImFyaWE/LnZpZXdlckxhYmVsXCI+XG4gIDxsaSAqbmdJZj1cIiFkaXNwbGF5ZWRJdGVtcz8ubGVuZ3RoXCIgY2xhc3M9XCJ2aWV3ZXItaW5pdGlhbC1pdGVtXCI+PC9saT5cbiAgPGxpXG4gICAgI2l0ZW1zUmVmXG4gICAgKm5nRm9yPVwibGV0IGl0ZW0gb2YgZGlzcGxheWVkSXRlbXM7IGxldCBpID0gaW5kZXhcIlxuICAgIG1lZGlhXG4gICAgW2F0dHIudGFiaW5kZXhdPVwiaXRlbVRhYmJhYmxlKGkpXCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIml0ZW0uYWx0XCJcbiAgICBbYXR0ci5hcmlhLWRlc2NyaWJlZGJ5XT1cIid2aWV3ZXItYXJpYS1kZXNjcmlwdGlvbi0nICsgaVwiXG4gICAgKGNsaWNrKT1cIm9uSW1hZ2VDbGljayhpdGVtLCAkZXZlbnQpXCJcbiAgICAobWVkaWFMb2FkRXJyb3IpPVwib25JdGVtRXJyb3JlZChpdGVtKVwiXG4gICAgKGtleWRvd24uVGFiKT1cIm9uVGFiKGkgKyAxKVwiXG4gICAgKGtleWRvd24uc2hpZnQuVGFiKT1cIm9uVGFiKGkgLSAxKVwiXG4gID5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiIWl0ZW1UZW1wbGF0ZTsgZWxzZSBjdXN0b21UZW1wbGF0ZVwiPlxuICAgICAgPHBpY3R1cmUgKm5nSWY9XCIhaXRlbS52aWRlb1wiIEBtZWRpYUFuaW1hdGU+XG4gICAgICAgIDxzb3VyY2VcbiAgICAgICAgICAqbmdGb3I9XCJsZXQgc291cmNlIG9mIGl0ZW0ucGljdHVyZVNvdXJjZXNcIlxuICAgICAgICAgIFtzcmNzZXRdPVwic291cmNlLnNyY3NldFwiXG4gICAgICAgICAgW2F0dHIubWVkaWFdPVwic291cmNlLm1lZGlhXCJcbiAgICAgICAgICBbYXR0ci5zaXplc109XCJzb3VyY2Uuc2l6ZXNcIlxuICAgICAgICAgIFthdHRyLnR5cGVdPVwic291cmNlLnR5cGVcIlxuICAgICAgICAvPlxuICAgICAgICA8aW1nXG4gICAgICAgICAgW3NyY109XCJpdGVtLnNyY1wiXG4gICAgICAgICAgW2FsdF09XCJpdGVtLmFsdFwiXG4gICAgICAgICAgW2F0dHIubG9hZGluZ109XCJsb2FkaW5nXCJcbiAgICAgICAgICBbc3R5bGUub2JqZWN0Rml0XT1cIm9iamVjdEZpdFwiXG4gICAgICAgIC8+XG4gICAgICA8L3BpY3R1cmU+XG4gICAgICA8IS0tIFVzaW5nIGxvYWRlZG1ldGFkYXRhIGluc3RlYWQgb2YgbG9hZGVkZGF0YSBiZWNhdXNlIGlPUyBsb2FkcyBkYXRhIGxhemlseSB1cG9uIHVzZXIncyBpbnRlcmFjdGlvbiAtLT5cbiAgICAgIDx2aWRlb1xuICAgICAgICAqbmdJZj1cIiFpc1lvdXR1YmUoaXRlbSkgJiYgaXRlbS52aWRlb1wiXG4gICAgICAgIEBtZWRpYUFuaW1hdGVcbiAgICAgICAgW3NyY109XCJpdGVtLnNyY1wiXG4gICAgICAgIFtwb3N0ZXJdPVwiaXRlbS50aHVtYlNyYyB8fCAnJ1wiXG4gICAgICAgIFthdHRyLnByZWxvYWRdPVwibG9hZGluZyA9PT0gJ2xhenknID8gJ21ldGFkYXRhJyA6ICdhdXRvJ1wiXG4gICAgICAgIFtzdHlsZS5vYmplY3RGaXRdPVwib2JqZWN0Rml0XCJcbiAgICAgICAgY29udHJvbHNcbiAgICAgICAgcGxheXNpbmxpbmVcbiAgICAgID48L3ZpZGVvPlxuXG4gICAgICA8aWZyYW1lXG4gICAgICAgICpuZ0lmPVwiaXNZb3V0dWJlKGl0ZW0pXCJcbiAgICAgICAgQG1lZGlhQW5pbWF0ZVxuICAgICAgICBbYXR0ci5sb2FkaW5nXT1cImxvYWRpbmdcIlxuICAgICAgICBbc3JjXT1cIml0ZW0uc3JjIHwgc2FmZVwiXG4gICAgICAgIGFsbG93PVwiYWNjZWxlcm9tZXRlcjsgYXV0b3BsYXk7IGVuY3J5cHRlZC1tZWRpYTsgZ3lyb3Njb3BlOyBwaWN0dXJlLWluLXBpY3R1cmVcIlxuICAgICAgICBhbGxvd2Z1bGxzY3JlZW5cbiAgICAgID48L2lmcmFtZT5cbiAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJpdGVtRmFpbGVkVG9Mb2FkKGl0ZW0pXCI+XG4gICAgICA8ZGl2XG4gICAgICAgICpuZ0lmPVwiIWVycm9yVGVtcGxhdGU7IGVsc2UgJGFueShlcnJvclRlbXBsYXRlKVwiXG4gICAgICAgIGNsYXNzPVwidmlld2VyLWVycm9yXCJcbiAgICAgID5cbiAgICAgICAgPGRpdiBjbGFzcz1cInZpZXdlci1lcnJvci1pY29uXCI+4pqgPC9kaXY+XG4gICAgICAgIDxwIGNsYXNzPVwidmlld2VyLWVycm9yLXRleHRcIj5cbiAgICAgICAgICB7eyBlcnJvclRleHQgfHwgJ0xvYWRpbmcgb2YgdGhpcyBtZWRpYSBmYWlsZWQnIH19XG4gICAgICAgIDwvcD5cbiAgICAgIDwvZGl2PlxuICAgIDwvbmctY29udGFpbmVyPlxuXG4gICAgPHNwYW5cbiAgICAgIFtpZF09XCIndmlld2VyLWFyaWEtZGVzY3JpcHRpb24tJyArIGlcIlxuICAgICAgY2xhc3M9XCJzci1vbmx5XCJcbiAgICAgIFtpbm5lckhUTUxdPVwiaXRlbS5kZXNjcmlwdGlvblwiXG4gICAgPjwvc3Bhbj5cblxuICAgIDxuZy10ZW1wbGF0ZSAjY3VzdG9tVGVtcGxhdGU+XG4gICAgICA8bmctY29udGFpbmVyXG4gICAgICAgICpuZ1RlbXBsYXRlT3V0bGV0PVwiXG4gICAgICAgICAgJGFueShpdGVtVGVtcGxhdGUpO1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIGluZGV4OiBpdGVtcz8uaW5kZXhPZihpdGVtKSxcbiAgICAgICAgICAgIHNlbGVjdGVkSW5kZXg6IHNlbGVjdGVkSW5kZXgsXG4gICAgICAgICAgICBpdGVtOiBpdGVtLFxuICAgICAgICAgICAgdmlkZW86IGl0ZW0udmlkZW9cbiAgICAgICAgICB9XG4gICAgICAgIFwiXG4gICAgICA+PC9uZy1jb250YWluZXI+XG4gICAgPC9uZy10ZW1wbGF0ZT5cbiAgPC9saT5cbjwvdWw+XG5cbjxidXR0b25cbiAgKm5nSWY9XCJzaG93TmV4dEFycm93XCJcbiAgYXJpYS1sYWJlbD1cIk5leHQgaW1hZ2VcIlxuICBjbGFzcz1cInZpZXdlci1hcnJvdyB2aWV3ZXItYXJyb3ctbmV4dFwiXG4gIChtb3VzZWRvd24pPVwiJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpXCJcbiAgKGNsaWNrKT1cInNlbGVjdEJ5RGVsdGEobW92ZUJ5SXRlbXMpXCJcbj5cbiAgPGNoZXZyb24taWNvbiAqbmdJZj1cIiFhcnJvd1RlbXBsYXRlOyBlbHNlICRhbnkoYXJyb3dUZW1wbGF0ZSlcIj48L2NoZXZyb24taWNvbj5cbjwvYnV0dG9uPlxuXG48Y291bnRlclxuICAqbmdJZj1cImNvdW50ZXIgJiYgaXRlbXMubGVuZ3RoXCJcbiAgW2l0ZW1RdWFudGl0eV09XCJpdGVtcy5sZW5ndGhcIlxuICBbc2VsZWN0ZWRJbmRleF09XCJjb3VudGVySW5kZXhcIlxuICBbb3JpZW50YXRpb25dPVwiY291bnRlck9yaWVudGF0aW9uXCJcbj48L2NvdW50ZXI+XG5cbjxuZy1jb250YWluZXJcbiAgKm5nVGVtcGxhdGVPdXRsZXQ9XCJcbiAgICAkYW55KGNvbnRlbnRUZW1wbGF0ZSk7XG4gICAgY29udGV4dDoge1xuICAgICAgc2VsZWN0ZWRJbmRleDogc2VsZWN0ZWRJbmRleFxuICAgIH1cbiAgXCJcbj48L25nLWNvbnRhaW5lcj5cblxuPGRpdlxuICAqbmdJZj1cImRlc2NyaXB0aW9ucyAmJiBpdGVtc1wiXG4gIGNsYXNzPVwidmlld2VyLWRlc2NyaXB0aW9uXCJcbiAgW2NsYXNzLnZpZXdlci1kZXNjcmlwdGlvbi0tYWJvdmUtY291bnRlcl09XCJcbiAgICBjb3VudGVyICYmIGNvdW50ZXJPcmllbnRhdGlvbiA9PT0gJ2JvdHRvbSdcbiAgXCJcbiAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbj5cbiAgPGRpdlxuICAgICpuZ0lmPVwiaXRlbXNbc2VsZWN0ZWRJbmRleF0/LmRlc2NyaXB0aW9uIGFzIGRlc2NyaXB0aW9uXCJcbiAgICBjbGFzcz1cInZpZXdlci1kZXNjcmlwdGlvbi1pbm5lclwiXG4gICAgW2lubmVySFRNTF09XCJkZXNjcmlwdGlvblwiXG4gICAgKGNsaWNrKT1cImRlc2NyaXB0aW9uQ2xpY2suZW1pdCgkZXZlbnQpXCJcbiAgPjwvZGl2PlxuPC9kaXY+XG4iXX0=